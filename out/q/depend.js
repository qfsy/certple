const Version="1.0.230820";console.log("LICENSE: GPL-3.0, https://github.com/xiangyuecn/ACME-HTML-Web-Browser-Client/blob/main/LICENSE");var acmeReadDirGotoCORSInit=function(){if(window.IsReadDirGotoCORS){var e=$(".acmeReadDirGotoCORSState").show().html(`\n<div style="color:#cb1d1d">\n<span class="langCN">本客户端正在以跨域兼容模式运行，请按正常流程操作即可，目标ACME服务URL=${window.Default_ACME_URL}</span>\n<span class="langEN"></span>\n</div>\n`);LangReview(e)}},acmeReadDirGotoCORS=function(){"use strict";var e="// "+Lang("请复制本代码到打开的ACME服务URL页面的浏览器控制台中运行。","",!0)+"\n\nvar Default_ACME_URL="+JSON.stringify(ACME.URL)+";\nvar IsReadDirGotoCORS=true;\nvar PageRawHTML=`"+PageRawHTML.replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$\{/g,"$\\{")+"`;";e+="\n("+function(){console.clear(),document.head.innerHTML=/<head[^>]*>([\S\s]+?)<\/head>/i.exec(PageRawHTML)[1],document.body.innerHTML=/<body[^>]*>([\S\s]+)<\/body>/i.exec(PageRawHTML)[1];for(var e,t=/<script[^>]*>([\S\s]+?)<\/script>/gi;e=t.exec(PageRawHTML);)eval.call(window,e[1])}.toString()+")()",$(".gotoCORSBox").hide();var t=$(".acmeReadDirState").append('\n<div class="gotoCORSBox" style="padding-top:15px">\n<div class="pd Bold" style="color:red">\n<i class="must">*</i>\n'+(title||'\n<span class="langCN">由于此ACME服务对跨域访问支持不良，</span>\n<span class="langEN"></span>\n<span style="font-size:24px">\n<span class="langCN">请按下面步骤操作：</span>\n<span class="langEN"></span>\n</span>')+`\n</div>\n<div style="padding-left:40px">\n<div class="pd">\n<span class="langCN">1. 请在浏览器中直接打开此ACME服务URL，<a href="${ACME.URL}" target="_blank">点此打开</a>；</span>\n<span class="langEN"></span>\n</div>\n<div class="pd">\n<span class="langCN">2. 在上一步打开的页面中打开浏览器控制台（需等页面加载完成后，再按F12键）；</span>\n<span class="langEN"></span>\n</div>\n<div class="pd">\n<span class="langCN">3. 复制以下代码，在第2步打开的浏览器控制台中运行，然后就可以正常申请证书了。</span>\n<span class="langEN"></span>\n</div>\n<div class="pd" style="font-size:13px;color:#aaa">\n<span class="langCN">工作原理：代码内包含了本页面源码，在目标页面内运行后将原样的显示出本客户端，然后按正常流程操作即可，此时已没有跨域问题了（既然打不过，那就加入他们）。</span>\n<span class="langEN"></span>\n</div>\n</div>\n<div style="padding-top:20px">\n<textarea class="gotoCORSText" style="width:100%;height:200px" readonly></textarea>\n</div>\n</div>\n`);$(".gotoCORSText").val(e),LangReview(t)},verifyBoxShow=function(){"use strict";for(var e=$(".verifyBox").html(""),t=JSON.parse(JSON.stringify(ACME.StepData.auths)),n=ACME.StepData.config.domains,a=0;a<n.length;a++){for(var r=n[a],o=t[r],i=o.challenges,s=0;s<i.length;s++){var c=i[s];c.challIdx=s,c.name=ACME.ChallName(c),c._sort=ACME.ChallSort(c)}i.sort(function(e,t){return e._sort.localeCompare(t._sort)});var l="";for(s=0;s<i.length;s++){var u=i[s];l+=`\n<label>\n<input type="radio" name="choice_authItem_${a}"\nclass="form-check-input choice_authChall choice_authChall_${a} choice_authChall_${a}_${s}"\nvalue="${a}_${s}" challidx="${u.challIdx}">&nbsp;${u.name}\n</label><br>\n`}e.append(`\n<div class="itemBox my-5" style="border: #ccc 1px solid; border-radius: 10px;">\n<div class="pd FlexBox">\n<div style="background-color: #00ff6e25; border: none; padding: 16px 32px; border-radius: 10px 10px 0px 0px;" class="mb-3 fw-bold">域名：${r}</div>\n<div class="FlexItem" style="padding: 0 32px;">${l}</div>\n</div>\n<div class="verifyItemBox_${a}" style="padding: 0 32px;"></div>\n<div class="verifyItemState_${a} pb-3" style="padding: 0 32px;"></div>\n</div>\n`)}LangReview(e),$(".choice_authChall").bind("click",function(e){var a=e.target,r=a.value.split("_"),o=+r[0],i=+r[1],s=n[o],c=t[s],l=c.challenges[i],u=['<div class="mt-1" style="font-size:12px;color:#aaa">'],p="color: #333;";"dns-01"==l.type?(u.push(Lang("前往域名权威 DNS 服务器中添加以下 TXT 记录。在 添加 DNS 记录 后强烈建议等待 30 秒后再点击开始验证。因为如果验证失败，需要重新提交信息。"," ")+"</div>"),u.push(`<div class="pd FlexBox my-3">\n<div style="${p}">${Lang("主机记录：","")}</div>\n<div class="FlexItem">\n<input class="form-control q-form" readonly value="_acme-challenge.${c.identifier.value}" />\n</div>\n</div>\n<div class="pd FlexBox mb-3">\n<div style="${p}">${Lang("TXT 记录值：","")}</div>\n<div class="FlexItem">\n<input class="form-control q-form" readonly value="${l.authTxtSHA256}" />\n</div>\n</div>`)):"http-01"==l.type?(u.push(Lang("在网站根目录中创建 <b>/.well-known/acme-challenge/</b> 目录，目录内创建 <b>"+FormatText(l.token)+'</b> 文件，文件内保存下面的文件内容，保存好后 <a href="http://'+c.identifier.value+"/.well-known/acme-challenge/"+FormatText(l.token)+'" target="_blank">打开验证文件</a> 测试能否能够正常访问。这个文件 URL 必须是 80 端口，并且公网可以访问，否则 ACME 无法访问到此地址将会验证失败。Windows 操作提示： Windows 中用 <b>.well-known.</b> 作为文件夹名称就能创建 <b>.well-known</b> 文件夹； IIS 可能需在此文件夹下的 MIME 类型中给 <b>.</b> 添加 <b>text/plain</b> 。'," ")+"</div>"),u.push(`<div class="pd FlexBox my-3">\n<div style="${p}">${Lang("文件路径：","")}</div>\n<div class="FlexItem">\n<input class="form-control q-form" readonly value="http://${c.identifier.value}/.well-known/acme-challenge/${FormatText(l.token)}" />\n</div>\n</div>\n<div class="pd FlexBox mb-3">\n<div style="${p}">${Lang("文件内容：","")}</div>\n<div class="FlexItem">\n<input class="form-control q-form" readonly value="${l.authTxt}" />\n</div>\n</div>`)):(u.push(Lang("非预定义验证类型，请使用 <b>Key Authorizations (Token+.+指纹)</b> 自行处理，<b>Digest</b> 为 Key Authorizations 的 SHA-256 Base64 值。","")+"</div>"),u.push(`<div class="pd FlexBox my-3">\n<div style="${p}">Key Authorizations: </div>\n<div class="FlexItem">\n<input class="form-control q-form" readonly value="${l.authTxt}" />\n</div>\n</div>\n<div class="pd FlexBox mb-3">\n<div style="${p}">Digest (SHA-256 Base64): </div>\n<div class="FlexItem">\n<input class="form-control q-form" readonly value="${l.authTxtSHA256Base64}" />\n</div>\n</div>`)),$(".verifyItemBox_"+o).html(u.join("\n"))});for(a=0;a<n.length;a++){var p=$(".choice_authChall_"+a+"_0");p[0]&&p[0].click()}};(function(){"use strict";var e="ACME_HTML_choice_acmeURL",t="ACME_HTML_input_domains",n="ACME_HTML_input_email",a={};window.initMainUI=function(){$(".eccCurveNames").html(X509.SupportECCType2Names().join(Lang("、",", "))),$(".donateBtnIco").html(unescape("%uD83D%uDE18")),$(".versionBox").html(Lang("版本: "+Version,"")),/mobile/i.test(navigator.userAgent)&&($(".main").prepend($(".langBtnBox").css("position",null)),$(".donateWidget").css("position",null)),CLog("initMainUI",0,Lang("OK","OK")),L(),acmeReadDirGotoCORSInit(),downloadFileNameShow(),o(),s(),E()};var r,o=function(){$("input[name=choice_acmeURL]").bind("click",function(e){var t=e.target,n="manual"==t.value;$(".in_acmeURL").css("opacity",n?1:.4).val(n?r:t.value).attr("readonly",n?null:"");var a=$(t).attr("desckey");$(".descAcmeURL").hide(),a&&$("."+a).show(),r="",h()}),i()},i=function(){r=a.acmeURL||window.Default_ACME_URL||localStorage[e]||"";var t=$("input[name=choice_acmeURL]"),n=0;if(r){for(var o=0,i=0;i<t.length;i++)t[i].value==r&&(n=i+1),"manual"==t[i].value&&(o=i+1);n||(n=o),n--}t[n].click()},s=function(){$(".privateKeyBox").hide(),$("input[name=choice_privateKey]").bind("click",function(e){var t=e.target,n="manual"==t.value;$(".in_privateKey").css("opacity",n?1:.4).val("").attr("readonly",n?null:""),$(".privateKeyBox").show(),C(t.value),f()}),$(".accountKeyBox").hide(),$("input[name=choice_accountKey]").bind("click",function(e){var t=e.target,n="manual"==t.value;$(".in_accountKey").css("opacity",n?1:.4).val("").attr("readonly",n?null:""),$(".accountKeyBox").show(),y(t.value),f()})},c=function(){return"<span>"+Lang("继续"," ")+"</span>"},l=function(){return Lang(" 请稍候... ","")},u=function(){return Lang(" 请重试！","")},p=function(e,t,n,a){var r=new Date,o=("0"+r.getHours()).substr(-2)+":"+("0"+r.getMinutes()).substr(-2)+":"+("0"+r.getSeconds()).substr(-2);return $(e).html(!1===t?"":'<div style="color:'+(n?1==n?"red":2==n?"#0b1":3==n?"#fa0":n:"")+'">'+(null==a?"["+o+"] ":a)+t+"</div>"),t};window.Toast=function(e,t,n){p(".toastState",e,t,""),$(".toastState").show(),clearTimeout(Toast._int),Toast._int=setTimeout(function(){$(".toastState").hide()},n||5e3)},window.onerror=function(e,t,n,a,r){Toast("【Uncaught Error】"+e+"<pre>at:"+n+":"+a+" url:"+t+"\n"+(r&&r.stack||"-")+"</pre>",1,15e3)};var d=0,g=function(e,t,n){if(e!=d){var a=Lang("被终止","",1);return CLog(t+" "+a,3,"From: "+n+" ["+a+"]"),!0}},h=function(){d++,$(".step1Hide").hide(),$(".step1Show").show(),p(".acmeReadDirState",!1),$(".in_acmeURL").val()&&acmeReadDirClick()};window.acmeReadDirClick=function(){var t=++d;$(".step1Hide").hide(),$(".step1Show").show();var n="Step-1",a=".acmeReadDirState",r=$(".in_acmeURL").val().trim();if(r){localStorage[e]=r,r=ACME.URL=r.replace(/\/$/,"");var o,i=CLog(n,0,p(a,l()+Lang("正在初始化，"," ")+" URL="+ACME.URL,2)),s=function(){ACME.Directory(function(e,t){o=function(n,a){e.corsOK=n?1:-1,e.corsError=a||"",t()},1==e.corsOK?h():-1==e.corsOK?y(e.corsError,!0):C()},function(e,r){g(t,n,i+" err: "+e)||(0===r?(CLog(n,1,p(a,Lang("初始化出错：无法访问此URL。","")+u(),1)),acmeReadDirGotoCORS(Lang("如果你可以在浏览器中直接打开并访问此ACME服务URL，代表此ACME服务对跨域访问支持不良，则请按下面步骤操作：",""))):CLog(n,1,p(a,Lang("初始化出错："+e,"")+u(),1)))})},h=function(){g(t,n,i)||(f(),CLog(n,0,p(a,Lang("正常，"," ")+c(),2),ACME.DirData))},C=function(){g(t,n,i)||(i=CLog(n,0,p(a,l()+Lang("正在测试浏览器支持情况，","")+" URL="+ACME.URL,2)),ACME.GetNonce(!0,function(){ACME.TestAccountCORS(function(){CLog(n,0,Lang("此 ACME 服务对浏览器的支持良好。","")),o(!0),h()},y)},function(e,t){t&&o(!1,e),y(e,t)}))},y=function(e,r){g(t,n,i+" err: "+e)||(CLog(n,1,p(a,Lang("测试此ACME服务对浏览器的支持情况，发生错误："+e,"")+(r?"":u()),1)),LangReview(a),r&&acmeReadDirGotoCORS())};s()}else p(a,Lang("请填写服务URL！",""),1)};var f=function(){document.getElementById("q-steps1").style.display="none",document.getElementById("q-steps2").style.display="",$(".step2Hide").hide(),$(".step2Show").show(),p(".configStepState",!1),$(".eabShow")[ACME.StepData.needEAB?"show":"hide"](),a.eabKid&&$(".in_eab_kid").val(a.eabKid),a.eabKey&&$(".in_eab_key").val(a.eabKey),$(".termsAgreeBox")[ACME.StepData.termsURL?"show":"hide"](),$(".termsAgreeTips").html(Lang('我同意此证书颁发机构ACME服务的<a href="'+ACME.StepData.termsURL+'" target="_blank">服务条款</a>。',"")),$(".choice_termsAgree").prop("checked",!0);var e=$(".in_domains"),r=localStorage[t],o=a.domains&&a.domains.join(", ")||r;e.val()||e.val(o||""),$(".choice_domains_store").prop("checked",!!r);e=$(".in_email"),r=localStorage[n],o=a.email||r;e.val()||e.val(o||""),$(".choice_email_store").prop("checked",!!r);var i=function(e){a[e]&&($("input[name=choice_"+e+"][value=manual]")[0].click(),$(".in_"+e).val(a[e]))};i("privateKey"),i("accountKey"),a={}},C=function(e){var t,n=++d,a="Step-2",r=".privateKeyState",o="";if("generateRSA"==e)e="RSA",t=X509.DefaultType2_RSA,o=Lang("证书 RSA 私钥 ("+t+" Bit)"," ");else{if("generateECC"!=e)return void p(r,!1);e="ECC",t=X509.DefaultType2_ECC;var i=X509.SupportECCType2[t]||t;o=Lang("证书 ECC 私钥 ("+i+")"," ")}var s=CLog(a,0,p(r,l()+Lang("正在创建","")+o,2));X509.KeyGenerate(e,t,function(e){g(n,a,s)||($(".in_privateKey").val(e),CLog(a,0,p(r,o+Lang("，创建成功。",""),2),"\n"+e))},function(e){g(n,a,s+" err: "+e)||CLog(a,1,p(r,o+Lang("，发生错误："+e,""),1))})},y=function(e){var t,n=++d,a="Step-2",r=".accountKeyState",o="";if("generateRSA"==e)e="RSA",t=X509.DefaultType2_RSA,o=Lang("ACME 账户 RSA 私钥 ("+t+" Bit)"," ");else{if("generateECC"!=e)return void p(r,!1);e="ECC",t=X509.DefaultType2_ECC;var i=X509.SupportECCType2[t]||t;o=Lang("ACME 账户 ECC 私钥 ("+i+")"," ")}var s=CLog(a,0,p(r,l()+Lang("正在创建","")+o,2));X509.KeyGenerate(e,t,function(e){g(n,a,s)||($(".in_accountKey").val(e),CLog(a,0,p(r,o+Lang("，创建成功，请复制保管，下次输入自己的账户私钥。",""),2),"\n"+e))},function(e){g(n,a,s+" err: "+e)||CLog(a,1,p(r,o+Lang("，发生错误："+e,""),1))})};window.configStepClick=function(){var e=++d,a="Step-2",r=".configStepState";$(".step2Hide").hide(),$(".step2Show").show(),p(r,!1);var o=$(".in_domains").val().trim(),i=$(".choice_domains_store").prop("checked"),s=$(".in_privateKey").val().trim(),u=$(".in_accountKey").val().trim(),h=$(".in_email").val().trim(),f=$(".choice_email_store").prop("checked"),C=$(".in_eab_kid").val().trim(),y=$(".in_eab_key").val().trim(),v=$(".choice_termsAgree").prop("checked");o=o.replace(/\s+/g,",").replace(/，+/g,",").split(/,+/);for(var A=0,E={};A<o.length;A++){var w=o[A];if(w){if(E[w])return p(r,Lang("域名"+w+"重复！",""),1);if(/[:\/;]/.test(w))return p(r,Lang("域名"+w+"格式错误！",""),1);E[w]=1}else o.splice(A,1),A--}if(localStorage[t]=i?o.join(", "):"",localStorage[n]=f?h:"",!o.length)return p(r,Lang("ERROR 域名是必须项。"," "),1);if(!u)return p(r,Lang("ERROR 需要创建或输入 ACME 账户的私钥。"," "),1);if(!s)return p(r,Lang("ERROR 需要证书的私钥。"," "),1);if(!/.+@.+\..+/.test(h)||/[\s,;]/.test(h))return p(r,Lang("ERROR 需要填写电子邮箱地址。"," "),1);if(ACME.StepData.needEAB&&(!C||!y))return p(r,Lang("EAB KID and HMAC KEY not found."," "),1);if(ACME.StepData.termsURL&&!v)return p(r,Lang("ERROR 需要同意使用条款。"," "),1);var m,L,M=function(){X509.KeyParse(s,function(e){m=e,D()},function(e){p(r,Lang("ERROR 证书私钥无效",""),1)},1)},D=function(){X509.KeyParse(u,function(e){L=e,b()},function(e){p(r,Lang("ERROR 账户私钥无效，无法工作，请前往<a href='/settings/'>设置</a>页面清空数据",""),1)},1)},R=CLog(a,0,p(r,l(),2)),b=function(){g(e,a,R)||(ACME.StepData.config={domains:o,privateKey:m,accountKey:L,email:h,eabKid:C,eabKey:y},CLog(a,0,"config",ACME.StepData.config),B())},B=function(){var t=CLog(a,0,p(r,l()+Lang("调用 ACME 服务 newAccount 接口："," ")+ACME.DirData.newAccount,2));ACME.StepAccount(function(){g(e,a,t)||N()},function(n){g(e,a,t+" err: "+n)||CLog(a,1,p(r,Lang("调用 ACME 服务的 newAccount 接口："," ")+ACME.DirData.newAccount+Lang("，发生错误："+n,""),1))})},N=function(){var t,n=function(n){e==d&&(t=CLog(a,0,p(r,l()+Lang("调用 ACME 服务订单接口。"," ")+" "+n+" URL:"+ACME.DirData.newOrder,2)))};n(""),ACME.StepOrder(n,function(){g(e,a,t)||x()},function(n){g(e,a,t+" err: "+n)||CLog(a,1,p(r,Lang("调用 ACME 服务订单接口：","")+ACME.DirData.newOrder+Lang("，发生错误："+n,""),1))})},x=function(){S(),CLog(a,0,p(r,Lang("配置完成，","")+c(),2),ACME.StepData)};M()};var v,S=function(){document.getElementById("q-steps2").style.display="none",document.getElementById("q-steps3").style.display="",$(".step3Hide").hide(),$(".step3Show").show(),$(".verifyStepBtn").show(),$(".verifyRunStopBtn").hide(),$(".finalizeOrderBtn").hide(),p(".verifyStepState",!1),verifyBoxShow()};window.verifyRunStopClick=function(){++d;$(".verifyStepBtn").show(),$(".verifyRunStopBtn").hide(),$(".finalizeOrderBtn").hide(),p(".verifyStepState",!1),v&&v()},window.verifyStepClick=function(){var e=++d,t="Step-3",n=".verifyStepState";$(".step3Hide").hide(),$(".step3Show").show(),$(".verifyStepBtn").hide(),$(".verifyRunStopBtn").show(),$(".finalizeOrderBtn").hide(),p(n,!1);var a=ACME.StepData.config.domains,r=ACME.StepData.auths,o=function(o,i,s){for(var c=i||e!=d,l=0,u=0,g=0,h=0;h<a.length;h++){var f=a[h],C=r[f],y=C.challenges,v=$(".verifyItemState_"+h);if(11!=C.authState){if(o){for(var S=$("input[name=choice_authItem_"+h+"]"),A=0;A<S.length;A++){var E=S[A];E.checked?C.challIdx=+$(E).attr("challidx"):$(E.parentNode).hide()}C.authState=0,C.authTryCount=0,C.authError="",C.authTimer=0}var w=ACME.ChallName(y[C.challIdx]);12!=C.authState?(g++,c?(p(v,!1),clearTimeout(C.authTimer),C.authTimer=0):2==C.authState?p(v,Lang("准备 ... ","")+" "+C.authTryCount+" "+C.authError,3,""):1==C.authState?p(v,Lang("验证中 ... ",""),0,""):p(v,Lang("等待验证 ... ",""),0,"")):(p(v,w+Lang("，验证失败：","")+C.authError,1,""),u++)}else p(v,ACME.ChallName(y[C.challIdx])+" OK!",2,""),l++}if(!c||i){var m=Lang("请重试"," "),L=p(n,(s?Lang("验证失败，","")+m:c?Lang("已取消，","Canceled, ")+m:Lang("正在验证，请耐心等待 ... ",""))+"<div>"+Lang("验证通过：","")+l+", "+Lang("未通过：","")+u+", "+Lang("验证中：","")+g+"</div>",c?1:0);c&&CLog(t,1,L)}};o(1);var i=function(){if(e==d){o();for(var t,n=0,s=0,c=0,l=0;l<a.length;l++){var u=a[l],p=r[u];t||p.authState||(t=p),1==p.authState&&n++,11==p.authState&&s++,12==p.authState&&c++}return s==a.length?f():s+c==a.length?h():void(t&&!n&&(t.authState=1,t.authTryCount++,t.authError="",o(),ACME.StepVerifyAuthItem(t,t.challIdx,function(n,a,r){e==d&&(n?t.authState=11:(t.authState=2,t.authError=r,t.authTimer=setTimeout(function(){t.authState=0,t.authTimer=0,i()},a)),i())},function(n){e==d&&(t.authState=12,t.authError=n,i())})))}};CLog(t,0,"==========Verify Start==========");var s=function(){$(".verifyRunStopBtn").hide(),v=null,CLog(t,0,"==========Verify End==========")};v=function(){s(),o(0,1)};var h=function(){CLog(t,1,"Verify Fail!"),o(0,1,1),s()},f=function(){CLog(t,0,"Verify OK!"),s(),finalizeOrderClick()};window.finalizeOrderClick=function(){$(".finalizeOrderBtn").hide();var a,r=function(r){e==d&&(a=CLog(t,0,p(n,l()+Lang("验证已通过，正在签发证书。","")+" "+r,2)))};r(""),ACME.StepFinalizeOrder(r,function(){g(e,t,a)||(A(),CLog(t,0,p(n,Lang("验证已通过，证书已签发，","")+c(),2),ACME.StepData))},function(r){g(e,t,a+" err: "+r)||($(".finalizeOrderBtn").show(),CLog(t,1,p(n,Lang("签发证书发生错误，","")+u()+Lang("如果多次重试都无法签发证书，请直接刷新页面重新开始。","")+" Error: "+r,1)))})},i()};var A=function(){document.getElementById("q-steps2").style.display="none",document.getElementById("q-steps3").style.display="none",document.getElementById("q-steps4").style.display="",$(".step4Hide").hide(),$(".step4Show").show(),p(".downloadStepState",!1);var e=ACME.StepData.config,t=ACME.StepData.order.downloadPEM,n=t||Lang("未发现证书，请刷新页面重新开始。","",!0);let a=(new Date).toISOString(),r={cert:n,key:e.privateKey.pem,time:a,domains:e.domains},o=JSON.parse(localStorage.getItem("q-manageDataPairs"))||[];o.push(r),localStorage.setItem("q-manageDataPairs",JSON.stringify(o)),$(".txt_downloadCert").val(n),$(".txt_downloadKey").val(e.privateKey.pem),w=e.domains[0].replace(/^\*\./g,"").replace(/[^\w]/g,"_"),downloadFileNameShow(w);var i=[],s=function(e){return i.push("\n=========== "+e+" ==========="),i},c=Object.assign({acmeURL:ACME.URL,accountURL:ACME.StepData.account.url,X509:{DefaultType2_RSA:X509.DefaultType2_RSA,DefaultType2_ECC:X509.DefaultType2_ECC},Window:{DefaultDownloadFileNames:DefaultDownloadFileNames}},e);c.privateKey=e.privateKey.pem,c.accountKey=e.accountKey.pem;var l="/********** "+Lang($(".clientNameCN").html(),$(".clientNameEN").html(),!0)+" *********/";i.push(l),i.push(Lang("在线网址（GitHub）：","",!0)+"https://xiangyuecn.github.io/ACME-HTML-Web-Browser-Client/ACME-HTML-Web-Browser-Client.html"),i.push(Lang("在线网址（Gitee）：","",!0)+"https://xiangyuecn.gitee.io/acme-html-web-browser-client/ACME-HTML-Web-Browser-Client.html"),i.push(""),i.push("GitHub: https://github.com/xiangyuecn/ACME-HTML-Web-Browser-Client"),i.push("Gitee: https://gitee.com/xiangyuecn/ACME-HTML-Web-Browser-Client"),i.push(""),i.push(Lang("提示：你可以将本文件拖拽进客户端网页内，将自动填充本次证书申请的所有配置参数。","",!0)),i.push(""),s(Lang("证书申请时间","",!0)).push((new Date).toLocaleString()),s(Lang("域名列表","",!0)).push(e.domains.join(", ")),s(Lang("ACME服务地址","",!0)).push(ACME.URL),s(Lang("CSR文本","",!0)).push(ACME.StepData.order.orderCSR),s(Lang("证书PEM文本","",!0)).push(n),s(Lang("证书私钥PEM文本","",!0)).push(e.privateKey.pem),s(Lang("账户私钥PEM文本","",!0)).push(e.accountKey.pem),s(Lang("账户URL","",!0)).push(ACME.StepData.account.url),s(Lang("完整配置信息","",!0)).push("<ACME-HTML-Web-Browser-Client>"+JSON.stringify(c)+"</ACME-HTML-Web-Browser-Client>"),i.push(""),i.push(l),i.push(""),$(".txt_downloadLog").val(t?i.join("\n"):n)},E=function(){$("body").bind("dragover",function(e){e.preventDefault()}).bind("drop",function(e){e.preventDefault();var t=e.dataTransfer.files[0];if(t){var n=new FileReader;n.onload=function(e){var t=n.result,r=/ACME-HTML-Web-Browser-Client>(.+?)<\/ACME-HTML-Web-Browser-Client/.exec(t);if(!r)return Toast(Lang("拖入的文件中未发现配置信息，请拖上次申请证书时保存的记录LOG文件！",""),1);for(var o in a=JSON.parse(r[1]),a.X509)X509[o]=a.X509[o];for(var o in a.Window)window[o]=a.Window[o];CLog("DropConfigFile",0,"Reset Config",a),Toast(Lang("识别到拖入的记录LOG文件，已填充上次申请证书时使用的配置。",""),2),i(),downloadFileNameShow()},n.readAsText(t)}})},w="";window.DefaultDownloadFileNames={Cert:"",Key:"",Log:""},window.downloadBtnClick=function(e){var t=$(".txt_download"+e).val(),n=w;"Cert"==e&&(n+=".pem"),"Key"==e&&(n+=".key"),"Log"==e&&(n+=".log"),n=DefaultDownloadFileNames[e]||n;var a=URL.createObjectURL(new Blob([t],{type:"text/plain"})),r=document.createElement("A");r.href=a,r.download="ZSEncrypt_"+n,r.click()},window.downloadFileNameShow=function(e){e=e||"your_domain";var t=(DefaultDownloadFileNames.Cert||"").replace(/\.[^\.]+$/g,"");$(".downloadFileName").html(t||e),$(".downloadKeyFileName").html(DefaultDownloadFileNames.Key||e+".key"),$(".downloadCertFileName").html(DefaultDownloadFileNames.Cert||e+".pem")},window.Test_AllStepData_Save=function(){if(!ACME.StepData.order)throw new Error(Lang("未完成第二步操作","",!0));var e=ACME.StepData.config;delete ACME.PrevNonce,e.privateKey=e.privateKey.pem,e.accountKey=e.accountKey.pem,localStorage[m]=JSON.stringify(ACME),ACME=null,console.warn(Lang("仅供测试：已保存测试数据，需刷新页面","",!0))};var m="ACME_HTML_Test_AllStepData",L=function(){localStorage[m]&&console.warn(Lang("仅供测试：已保存测试数据，调用Test_Restore_StepXXX()进行恢复步骤界面","",!0))},M=function(e){var t=JSON.parse(localStorage[m]||"{}");if(!t.StepData)throw new Error(Lang("未保存数据","",!0));for(var n in t)ACME[n]=t[n];var a=ACME.StepData.config;X509.KeyParse(a.privateKey,function(t){a.privateKey=t,X509.KeyParse(a.accountKey,function(t){a.accountKey=t,console.log("ACME.StepData",ACME.StepData),setTimeout(function(){e()})})})};window.Test_Restore_StepAuth=function(){M(function(){console.warn(Lang("仅供测试：已手动恢复步骤三界面","",!0)),S()})},window.Test_Restore_StepDownload=function(){M(function(){console.warn(Lang("仅供测试：已手动恢复步骤四界面","",!0)),A()})}})(),function(){"use strict";window.ACME={URL:"",SyncID:0,DirData:{},Directory:function(e,t){var a=++ACME.SyncID,r=ACME.URL,o="ACME_HTML_cache_"+r,i=function(n){var r=n.data;if(a!=ACME.SyncID)return t("cancel");var i=r.meta||{};if(!r.newOrder)return t("Not newOrder found: "+FormatText(JSON.stringify(r)));ACME.DirData=r,ACME.StepData.termsURL=i.termsOfService,ACME.StepData.needEAB=!!i.externalAccountRequired;var s=function(){localStorage[o]=JSON.stringify(n)};s(),e(n,s)},s=JSON.parse(localStorage[o]||"{}");if(s.time&&Date.now()-s.time<864e5)return i(s);n(r,null,function(e){i({data:e,time:Date.now()})},t)},StepData:{},ChallName:function(e){return"dns-01"==e.type?Lang("DNS 记录验证"," "):"http-01"==e.type?Lang("文件验证"," "):e.type.toUpperCase()},ChallSort:function(e){return"dns-01"==e.type?"1_"+e.type:"http-01"==e.type?"2_"+e.type:"3_"+e.type},GetJwsA:async function(e,t){var n=ACME.StepData.config.accountKey,a="ES256",r={name:"ECDSA",hash:"SHA-256"};"RSA"==n.type&&(a="RS256",r={name:"RSASSA-PKCS1-v1_5"}),e.alg=a;var o={protected:Json2UrlB64(e),payload:t?Json2UrlB64(t):""},i=Str2Bytes(o.protected+"."+o.payload),s=await crypto.subtle.sign(r,n.key,i);return o.signature=Bytes2UrlB64(s),o},GetNonceA:function(e){return new Promise(function(t,n){ACME.GetNonce(e,function(e){t(e)},function(e){n(new Error(e))})})},GetNonce:function(e,t,a){var r=ACME.PrevNonce;if(ACME.PrevNonce="",!e&&r)return t(r);n({url:ACME.DirData.newNonce,method:"HEAD",response:!1},null,function(e,n){ACME.PrevNonce="";var r=n.getResponseHeader("Replay-Nonce");r?t(r):a("GetNonce: "+Lang("此ACME服务对浏览器访问支持太差，无法跨域获取Replay-Nonce响应头。","This ACME service has too poor browser access support to get the Replay-Nonce response header across domains."),!0)},function(e){a("GetNonce: "+e)})},TestAccountCORS:function(e,t){n({url:ACME.DirData.newAccount,method:"POST",response:!1,nocheck:!0},{},function(n,a){a.status>0?e():t("["+a.status+"]",!0)},function(e){t(e)})},StepAccount:async function(e,t){var n=++ACME.SyncID,a="ACME.StepAccount";CLog(a,0,"==========Account Start==========");var r="";try{await ACME._StepAccountA(n,a)}catch(e){r=e.message||"-",CLog(a,1,r,e)}CLog(a,0,"==========Account End=========="),r?t(r):e()},_StepAccountA:async function(n,a){var r=ACME.DirData.newAccount,o=ACME.StepData.config,i={contact:["mailto:"+o.email],termsOfServiceAgreed:!0};if(ACME.StepData.needEAB){var s={protected:Json2UrlB64({alg:"HS256",kid:o.eabKid,url:r}),payload:Json2UrlB64(X509.PublicKeyJwk(o.accountKey))},c=await crypto.subtle.importKey("raw",UrlB642Bytes(o.eabKey),{name:"HMAC",hash:"SHA-256"},!0,["sign"]),l=Str2Bytes(s.protected+"."+s.payload),u=await crypto.subtle.sign("HMAC",c,l);s.signature=Bytes2UrlB64(u),i.externalAccountBinding=s,CLog(a,0,"externalAccountBinding",s)}var p=await ACME.GetJwsA({jwk:X509.PublicKeyJwk(o.accountKey),nonce:await ACME.GetNonceA(!0),url:r},i),d=await t(r,p);if(n!=ACME.SyncID)throw new Error("cancel");ACME.StepData.account={url:e(d.xhr,"Location"),data:d.data},CLog(a,0,"Account OK",ACME.StepData.account)},StepOrder:async function(e,t,n){var a=++ACME.SyncID,r="ACME.StepOrder";CLog(r,0,"==========Order Start==========");var o="";try{await ACME._StepOrderA(e,a,r)}catch(e){o=e.message||"-",CLog(r,1,o,e)}CLog(r,0,"==========Order End=========="),o?n(o):t()},_StepOrderA:async function(n,a,r){for(var o=ACME.DirData.newOrder,i=ACME.StepData.config,s=[],c=0;c<i.domains.length;c++)s.push({type:"dns",value:i.domains[c]});var l={identifiers:s};n("newOrder...");var u=await ACME.GetJwsA({kid:ACME.StepData.account.url,nonce:await ACME.GetNonceA(),url:o},l),p=await t(o,u);if(a!=ACME.SyncID)throw new Error("cancel");p.data.orderUrl=e(p.xhr,"Location"),ACME.StepData.order=p.data,CLog(r,0,"Order OK",ACME.StepData.order);var d=JSON.stringify(X509.PublicKeyJwk(i.accountKey)),g=await crypto.subtle.digest({name:"SHA-256"},Str2Bytes(d));g=Bytes2UrlB64(g);var h=ACME.StepData.order.identifiers,f=0,C=ACME.StepData.order.authorizations;for(c=0;c<h.length;c++)-1==i.domains.indexOf(h[c].value)&&(f=1);if(f||h.length!=C.length||h.length!=i.domains.length)throw new Error(Lang("创建的订单中的域名和配置的不一致","The domain name in the created order is inconsistent with the configuration"));if(a!=ACME.SyncID)throw new Error("cancel");ACME.StepData.auths={};for(c=0;c<C.length;c++){n("auth("+(c+1)+"/"+C.length+")...");o=C[c],u=await ACME.GetJwsA({kid:ACME.StepData.account.url,nonce:await ACME.GetNonceA(),url:o},""),p=await t(o,u);if(a!=ACME.SyncID)throw new Error("cancel");p.data.domain=h[c].value,p.data.authUrl=o,ACME.StepData.auths[h[c].value]=p.data;for(var y=p.data.challenges,v=0;v<y.length;v++){var S=y[v];S.authTxt=S.token+"."+g;var A=await crypto.subtle.digest({name:"SHA-256"},Str2Bytes(S.authTxt));if(a!=ACME.SyncID)throw new Error("cancel");S.authTxtSHA256=Bytes2UrlB64(A),S.authTxtSHA256Base64=Bytes2Base64(A)}}CLog(r,0,"Order Authorizations",ACME.StepData.auths)},StepVerifyAuthItem:async function(e,t,n,a){var r="ACME.verify["+e.challenges[t].type+"]:"+e.domain,o="";try{await ACME._StepVerifyAuthItemA(e,t,ACME.SyncID,r,n,a)}catch(e){o=e.message||"-",CLog(r,1,o,e)}o&&n(!1,1e3,o)},_StepVerifyAuthItemA:async function(e,n,a,r,o,i){var s=e.challenges[n];if(!s.isSend){var c=s.url,l=await ACME.GetJwsA({kid:ACME.StepData.account.url,nonce:await ACME.GetNonceA(),url:c},{}),u=await t({url:c,nocheck:!0},l),p=u.xhr.status;p>=200&&p<300&&(s.isSend=!0)}c=e.authUrl,l=await ACME.GetJwsA({kid:ACME.StepData.account.url,nonce:await ACME.GetNonceA(),url:c},""),u=await t(c,l);var d=u.data;return"pending"==d.status?(CLog(r,0,"pending..."),o(!1,1e3,"pending...")):"valid"==d.status?(CLog(r,0,"valid OK"),o(!0)):(CLog(r,1,"Fail",d),i(d.status+": "+FormatText(JSON.stringify(d))))},StepFinalizeOrder:async function(e,t,n){var a=++ACME.SyncID,r="ACME.StepFinalizeOrder";CLog(r,0,"==========Finalize Start==========");var o="";try{await ACME._StepFinalizeOrderA(e,a,r)}catch(e){o=e.message||"-",CLog(r,1,o,e)}CLog(r,0,"==========Finalize End=========="),o?n(o):t()},_StepFinalizeOrderA:async function(e,n,a){var r=ACME.StepData.order,o=ACME.StepData.config,i=o.domains;if(!r.finalizeIsSend){e("finalize...");var s=await new Promise(function(e,t){X509.CreateCSR(o.privateKey,i[0],i,function(t){e(t)},function(e){t(new Error(e))})});r.orderCSR=s,CLog(a,0,"CSR\n"+s),s=Bytes2UrlB64(ASN1.PEM2Bytes(s));var c=r.finalize,l=await ACME.GetJwsA({kid:ACME.StepData.account.url,nonce:await ACME.GetNonceA(),url:c},{csr:s}),u=await t(c,l);if(n!=ACME.SyncID)throw new Error("cancel");CLog(a,0,"finalize result",u.data),r.finalizeIsSend=!0}for(var p=Date.now(),d=0;!r.checkOK&&Date.now()-p<6e4;){if(n!=ACME.SyncID)throw new Error("cancel");d++,e("check retry:"+d+"...");c=r.orderUrl,l=await ACME.GetJwsA({kid:ACME.StepData.account.url,nonce:await ACME.GetNonceA(),url:c},""),u=await t(c,l);if(n!=ACME.SyncID)throw new Error("cancel");var g=u.data;if("valid"==g.status){r.checkOK=!0,r.certUrl=g.certificate,CLog(a,0,"check OK",g);break}if("invalid"==g.status)throw CLog(a,1,"check Fail",g),new Error(g.status+": "+FormatText(JSON.stringify(g)));CLog(a,0,g.status+"... wait 1s",g),await new Promise(function(e){setTimeout(e,1e3)})}if(!r.downloadPEM){e("download...");c=r.certUrl,l=await ACME.GetJwsA({kid:ACME.StepData.account.url,nonce:await ACME.GetNonceA(),url:c},""),u=await t({url:c,response:!1},l);if(n!=ACME.SyncID)throw new Error("cancel");var h=u.xhr.responseText;r.downloadPEM=h,CLog(a,0,"download OK\n"+h)}}};var e=function(e,t){var n=e.getResponseHeader(t);if(!n)throw acmeReadDirGotoCORS(),new Error(Lang("无法读取响应头"+t+"，可能是因为此ACME服务对跨域访问支持不良，请按第一步显示的提示操作。","The response header "+t+" cannot be read, This may be because this ACME service does not support cross domain access, Please follow the prompt displayed in step 1."));return n},t=function(e,t){return new Promise(function(a,r){n(e,t,function(e,t){a({data:e,xhr:t})},function(e){r(new Error(e))})})},n=function(e,t,n,a){var r="string"==typeof e?{url:e}:e;e=r.url;var o=r.method||(t?"POST":"GET"),i="ACME.Request";CLog(i,4,"send "+o,r,t);var s=new XMLHttpRequest;s.timeout=3e4,s.open(o,e,!0),s.onreadystatechange=function(){if(4==s.readyState){ACME.PrevNonce=s.getResponseHeader("Replay-Nonce")||"";var e,t,o=s.status<200||s.status>=300,c=null==r.response||r.response;if(c||o){t=s.responseText;try{e=JSON.parse(t),t=e}catch(e){}}if(CLog(i,4,"send End",r,{status:s.status,headers:s.getAllResponseHeaders()},t),r.nocheck||!o&&(!c||e))return n(e,s);a((o?"["+s.status+"]":"")+FormatText(s.responseText),s.status)}},t?("object"==typeof t&&(t=JSON.stringify(t)),s.setRequestHeader("Content-Type",r.contentType||"application/jose+json"),s.send(t)):s.send()}}(),function(){"use strict";for(var e in window.X509={DefaultType2_RSA:"2048",DefaultType2_ECC:"P-256",SupportECCType2:{"P-256":"prime256v1","P-384":"secp384r1","P-521":"secp521r1"},SupportECCType2Names:function(){var e=[];for(var t in X509.SupportECCType2)e.push(X509.SupportECCType2[t]);return e},KeyGenerate:function(e,t,n,a){var r=0;if("RSA"==e)r={publicExponent:new Uint8Array([1,0,1]),name:"RSASSA-PKCS1-v1_5",modulusLength:+t,hash:"SHA-256"};else{if("ECC"!=e)return void a("Not support "+e);r={name:"ECDSA",namedCurve:t}}crypto.subtle.generateKey(r,!0,["sign","verify"]).then(function(e){crypto.subtle.exportKey("jwk",e.privateKey).then(function(e){n(X509.KeyExport(e))}).catch(function(e){a(Lang("此浏览器不支持导出"+r.name+"+PKCS#8格式密钥：","This browser does not support exporting "+r.name+"+PKCS#8 format keys: ")+e.message)})}).catch(function(e){a(Lang("此浏览器不支持生成"+r.name+"：","This browser does not support generating "+r.name+": ")+e.message)})},KeyParse:function(e,t,n,a){var r={},o=function(e){r.error=e,n(e,r)};if(!/BEGIN\s*(RSA|EC)?\s*(PUBLIC|PRIVATE)\s*KEY/.test(e))return o(Lang("不是RSA或ECC密钥","Not an RSA or ECC key"));r.type="EC"==RegExp.$1?"ECC":RegExp.$1;var i,s,c=!!RegExp.$1,l="PUBLIC"==RegExp.$2;if(l&&a)return o(Lang("不是私钥","Is not a private key"));try{var u=null,p=ASN1.ParsePEM(e);if(r.asn1=p,c){if("RSA"==r.type)u=p;else if("ECC"==r.type){if(l)return o(Lang("不支持ECC PKCS#1格式公钥","ECC PKCS#1 format public key is not supported"));var d=p.sub[2].sub[0].oid;r.type2=ASN1.OID[d]||"",u=p}}else{var g=l?0:1,h=p.sub[g].sub[0].oid;d=p.sub[g].sub[1].oid;r.type=ASN1.OID[h]||"",r.type2=ASN1.OID[d]||"",u="ECC"==r.type&&l?p:(new ASN1).parse(p.sub[g+1].bytes)}r.paramAsn1=u}catch(e){return o(Lang("密钥解析失败：","Key resolution failed: ")+e.message)}if("RSA"==r.type){g=l?0:1;r.param={n:u.sub[g].bytes,e:u.sub[g+1].bytes,d:l?null:u.sub[g+2].bytes};for(var f="p,q,dp,dq,qi".split(","),C=0;C<5;C++)r.param[f[C]]=l?null:u.sub[g+3+C].bytes;r.type2=8*r.param.n.length+""}else{if("ECC"!=r.type)return o(Lang("不支持的密钥类型：","Unsupported key type: ")+h)
;if(!X509.SupportECCType2[r.type2])return o(Lang("只支持"+X509.SupportECCType2Names().join("、")+"曲线的ECC密钥","ECC key only supported for "+X509.SupportECCType2Names().join(",")+" curve"));if(l)var y=u.sub[1].bytes;else g=c?3:2,y=u.sub[g].sub[0].bytes;if(4!=y[0])return o("ECC !0x04: "+y[0]);var v=(y.length-1)/2;r.param={x:y.slice(1,1+v),y:y.slice(1+v),d:l?null:u.sub[1].bytes}}for(var S in r.isPKCS1=c,r.hasPrivate=!l,r.pem=e,"RSA"==r.type?(i={publicExponent:new Uint8Array(r.param.n.buffer),name:"RSASSA-PKCS1-v1_5",modulusLength:+r.type2,hash:"SHA-256"},s={kty:"RSA",alg:"RS256"}):"ECC"==r.type&&(i={name:"ECDSA",namedCurve:r.type2},s={kty:"EC",crv:r.type2}),s=Object.assign(s,{ext:!0,key_ops:[l?"verify":"sign"]}),r.param)r.param[S]&&(s[S]=Bytes2UrlB64(r.param[S]));crypto.subtle.importKey("jwk",s,i,!0,[l?"verify":"sign"]).then(function(e){r.key=e,t(r)}).catch(function(e){o(Lang("密钥转成CryptoKey失败：","Failed to convert key to CryptoKey: ")+e.message)})},PublicKeyJwk:function(e){var t=e.param;if("RSA"==e.type)return{e:Bytes2UrlB64(t.e),kty:"RSA",n:Bytes2UrlB64(t.n)};if("ECC"==e.type)return{crv:e.type2,kty:"EC",x:Bytes2UrlB64(t.x),y:Bytes2UrlB64(t.y)};throw new Error("Jwk: "+e.type)},KeyExport:function(e,t,n){var a="KeyExport: ",r=ASN1.S,o=ASN1.V,i=e.param,s=i&&e.type,c=e.type2;if(!i){if(!e.kty)throw new Error(a+"bad key");s="EC"==e.kty?"ECC":e.kty,"ECC"==s&&(c=e.crv)}var l=("ECC"==s?"x,y,d":"n,e,d,p,q,dp,dq,qi").split(",");if(!i){i={};for(var u=0;u<l.length;u++){var p=l[u],d=e[p];d&&(i[p]=UrlB642Bytes(d))}}var g,h=!t&&i.d;if("RSA"==s){var f=r(48,o(2,i.n),o(2,i.e));if(h){f.sub.splice(0,0,o(2,[0]));for(u=2;u<l.length;u++)f.push(o(2,i[l[u]]))}g=f.toBytes()}else{if("ECC"!=s)throw new Error(a+s);var C=new Uint8Array(1+2*i.x.length);C[0]=4,C.set(i.x,1),C.set(i.y,1+i.x.length),g=h?r(48,o(2,[1]),o(4,i.d),r(161,o(3,C))).toBytes():C}var y=r(48,o(6,ASN1.OID2Bytes(ASN1.OID[s])),"RSA"==s?o(5,[]):o(6,ASN1.OID2Bytes(ASN1.OID[c])));if(h)var v=r(48,o(2,[0]),y,o(4,g));else v=r(48,y,o(3,g));if(2==n)return v;if(g=v.toBytes(),1==n)return g;var S=Bytes2Base64(g).replace(/(.{64})/g,"$1\n").trim(),A=h?"PRIVATE":"PUBLIC";return"-----BEGIN "+A+" KEY-----\n"+S+"\n-----END "+A+" KEY-----"},CreateCSR:function(e,t,n,a,r){var o=ASN1.S,i=ASN1.V;try{var s=X509.KeyExport(e,!0,2)}catch(e){return r(e.message)}for(var c=o(48),l=0;l<n.length;l++)c.push(i(130,Str2Bytes(n[l])));var u=o(48,i(2,[0]),o(48,o(49,o(48,i(6,ASN1.OID2Bytes("2.5.4.3")),i(12,Str2Bytes(t))))),s,o(160,o(48,i(6,ASN1.OID2Bytes("1.2.840.113549.1.9.14")),o(49,o(48,o(48,i(6,ASN1.OID2Bytes("2.5.29.17")),i(4,c.toBytes()))))))),p=u.toBytes(),d={name:"ECDSA",hash:"SHA-256"};"RSA"==e.type&&(d={name:"RSASSA-PKCS1-v1_5"}),crypto.subtle.sign(d,e.key,p).then(function(t){var n=new Uint8Array(t);if("ECC"==e.type){var r=n.subarray(0,e.param.x.length),s=n.subarray(e.param.x.length);n=o(48,i(2,r),i(2,s)).toBytes()}var c=o(48,u,o(48,i(6,ASN1.OID2Bytes(ASN1.OID["SHA256_"+e.type])),"RSA"==e.type?i(5,[]):null),i(3,n)),l=c.toBytes(),p=Bytes2Base64(l).replace(/(.{64})/g,"$1\n").trim();a("-----BEGIN CERTIFICATE REQUEST-----\n"+p+"\n-----END CERTIFICATE REQUEST-----")}).catch(function(e){r("CSR sign:"+e.message)})}},window.ASN1=function(e,t){this.sub=[],e&&this.setTag(e),t&&this.setBytes(t)},ASN1.S=function(e){for(var t=new ASN1(e),n=1,a=arguments;n<a.length;n++)a[n]&&t.push(a[n]);return t},ASN1.V=function(e,t){return new ASN1(e,t)},ASN1.ParsePEM=function(e){return(new ASN1).parsePEM(e)},ASN1.TagNames={"01":"BOOLEAN","02":"INTEGER","03":"BIT_STRING","04":"OCTET_STRING","05":"NULL","06":"OID","0C":"UTF8String",13:"Printable_String",17:"UTCTime",18:"GeneralizedTime",30:"SEQUENCE",31:"SET"},ASN1.OID={"1.2.840.113549.1.1.1":"RSA","1.2.840.113549.1.1.11":"SHA256_RSA","1.2.840.10045.2.1":"ECC","1.2.840.10045.4.3.2":"SHA256_ECC","1.2.840.10045.3.1.7":"P-256","1.3.132.0.34":"P-384","1.3.132.0.35":"P-521"},ASN1.OID)ASN1.OID[ASN1.OID[e]]=e;ASN1.OID2Bytes=function(e){var t=e.split("."),n=[],a=+t[0],r=+t[1];if(!/^[\d\.]+$/.test(e)||t.length<3||a>2||40*a+r>255)throw new Error("bad oid: "+e);n.push(40*a+r);for(var o=2,i=t.length;o<i;o++){for(var s=+t[o],c=[];s>=128;)c.push(s%128),s/=128;c.push(s),c.reverse();for(var l=0,u=c.length-1;l<=u;l++)l!=u?n.push(128+c[l]):n.push(c[l])}return new Uint8Array(n)},ASN1.OID2Text=function(e){var t="",n=e[0],a=n<80?n<40?0:1:2;t+=a+"."+(n-40*a);for(var r=1,o=e.length;r<o;){for(var i=0;r<o;){var s=e[r++];if(i*=128,!(s>=128)){i+=s;break}i+=s-128}t+="."+i}return t},ASN1.ParseSize=function(e,t){var n=t[e[0]++],a=0;if(n<128)a=n;else if(128==n)a=-404;else for(var r=0,o=127&n;r<o;r++)a=256*a+t[e[0]++];if(a<0||a>t.length-e[0])throw new Error("ASN.1 Bad size "+a);return a},ASN1.ParseBlock=function(e,t,n){for(n=n||[];e[0]<t.length;){var a=e[0],r=new ASN1,o=t[e[0]++],i=ASN1.ParseSize(e,t);if(0!=(32&o))r.parse(t.slice(a,e[0]+i));else{var s=t.slice(e[0],e[0]+i);2!=o&&3!=o||s.length>1&&0==s[0]&&(s=s.slice(1)),r.setTag(o),r.setBytes(s)}n.push(r),e[0]+=i}return n},ASN1.PEM2Bytes=function(e){e=e.replace(/[\s\r\n]/g,"");var t=/^-+BEGIN\w*-+([^-]+)-+END\w+-+$/i.exec(e);try{return Base642Bytes(t[1])}catch(e){throw new Error(Lang("不是pem格式。","Not a pem format."))}},ASN1.prototype={setTag:function(e){var t=(e<16?"0":"")+e.toString(16).toUpperCase();this.tag=e,this.tagTxt=t,this.tagName=ASN1.TagNames[t]||"0x"+t},setBytes:function(e){if(null==e.length||null==e.slice&&null==e.subarray)throw new Error("Not Array");6==this.tag&&(this.oid=ASN1.OID2Text(e)),12!=this.tag&&19!=this.tag||(this.string=Bytes2Str(e)),this.bytes=e},push:function(e){if(!e.parsePEM)throw new Error("Not ASN1");return this.sub.push(e),this},parsePEM:function(e){return this.parse(ASN1.PEM2Bytes(e))},parse:function(e){var t=[0];if(0==(32&e[0]))throw new Error("ASN.1 parse: Not SEQ");this.setTag(e[t[0]++]);var n=ASN1.ParseSize(t,e);return e=e.slice(t[0],t[0]+n),this.setBytes(e),ASN1.ParseBlock([0],e,this.sub),this},toBytes:function(e){var t=[],n=0;if(this.sub.length)for(var a=0;a<this.sub.length;a++){var r=this.sub[a].toBytes();t.push(r),n+=r.length}else this.bytes&&this.bytes.length&&((2==this.tag&&this.bytes[0]>=128||3==this.tag)&&(t.push([0]),n++),t.push(this.bytes),n+=this.bytes.length);if(!e){r=[];var o=n;if(o<128)r.push(o);else{for(;o>255;)r.push(255&o),o>>=8;r.push(255&o),r.push(128+r.length)}r.push(this.tag),r.reverse(),t.splice(0,0,r),n+=r.length}var i=new Uint8Array(n),s=0;for(a=0;a<t.length;a++){r=t[a];i.set(r,s),s+=r.length}return i}}}(),function(){"use strict";window.LangCur="cn",window.Lang=function(e,t,n){const a=e,r=" "+t,o=n;if(o)return"cn"==LangCur?a:r;var i="",s={cn:a,en:r};for(var c in s)i+=(LangCur!=c?"<!--LangHide1-->":"")+'<span class="lang'+c.toUpperCase()+'" style="'+(LangCur==c?"":"display:none")+'">'+s[c]+"</span>"+(LangCur!=c?"<!--LangHide2-->":"");return i},window.LangReview=function(e){var t=$(e||"body");t.find(".langCN")["cn"==LangCur?"show":"hide"](),t.find(".langEN")["cn"!=LangCur?"show":"hide"]();for(var n=t.find(".inputLang"),a=0;a<n.length;a++)n[a].setAttribute("placeholder",n[a].getAttribute("placeholder-"+LangCur))},window.LangClick=function(e){LangCur=e,LangReview(),$(".langBtn").css("color",null),$(".langBtn_"+e).css("color","#000"),$("body").css("wordBreak","cn"==e?"break-all":null),document.titleLang||(document.titleLang=document.title);for(var t=document.titleLang.split("|"),n=[],a=[],r=0;r<t.length;r++)/[^\x00-\xff]/.test(t[r])==("cn"==LangCur)?n.push(t[r].trim()):a.push(t[r].trim());document.title=n.concat(a).join(" | ")},window.CLog=function(e,t,n){var a=new Date,r=("0"+a.getMinutes()).substr(-2)+":"+("0"+a.getSeconds()).substr(-2)+"."+("00"+a.getMilliseconds()).substr(-3);n=n.replace(/<!--LangHide1[\S\s]+?LangHide2-->/g,""),n=n.replace(/<[^>]+>/g,"");for(var o=["["+r+" "+e+"]"+n],i=3;i<arguments.length;i++)o.push(arguments[i]);var s=1==t?console.error:3==t?console.warn:4==t?console.debug:console.log;return s.apply(console,o),n},function(){window.$=function(t){return t&&t.is$?t:new e(t)};var e=function(e,t){if(this.length=0,e)if(e.appendChild)this.push(e);else for(var n=(t||document).querySelectorAll(e),a=0;a<n.length;a++)this.push(n[a])};e.prototype={is$:1,push:function(e){this[this.length++]=e},find:function(t){var n=this[0];return new e(n?t:"",n)},val:function(e){return this.prop("value",e)},hide:function(){return this.css("display","none")},show:function(e){return this.css("display",void 0===e?null:e)},html:function(e){var t=this[0];if(void 0===e)return t&&t.innerHTML||"";for(var n=0;n<this.length;n++)this[n].innerHTML=e;return this},append:function(e){return this._end(e)},prepend:function(e){return this._end(e,1)},_end:function(e,t){var n=this[0];if(e&&n){var a=e;if("string"==typeof e){var r=document.createElement("div");r.innerHTML=e,a=[];for(var o=0;o<r.childNodes.length;o++)a.push(r.childNodes[o])}else e.appendChild&&(a=[e]);t&&(t=n.firstChild);for(o=0;o<a.length;o++)t?n.insertBefore(a[o],t):n.appendChild(a[o])}return this},prop:function(e,t){var n=this[0];if(void 0===t)return n&&n[e];for(var a=0;a<this.length;a++)this[a][e]=t;return this},attr:function(e,t){var n=this[0];if(void 0===t)return n&&n.getAttribute(e);for(var a=0;a<this.length;a++)null==t?this[a].removeAttribute(e):this[a].setAttribute(e,t);return this},css:function(e,t){for(var n=0;n<this.length;n++)this[n].style[e]=t;return this},bind:function(e,t){for(var n=0;n<this.length;n++)this[n].addEventListener(e,t);return this}}}(),window.FormatText=function(e){return e.replace(/[&<>='"]/g,function(e){return"&#"+e.charCodeAt(0)+";"})},window.Str2Bytes=function(e){e=unescape(encodeURIComponent(e));for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},window.Bytes2Str=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(escape(t))},window.Json2UrlB64=function(e){return Bytes2UrlB64(JSON.stringify(e))},window.Base642Bytes=function(e){for(var t=atob(e),n=new Uint8Array(t.length),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n},window.UrlB642Bytes=function(e){for(e=e.replace(/_/g,"/").replace(/-/g,"+");e.length%4;)e+="=";return Base642Bytes(e)},window.Bytes2UrlB64=function(e){return Bytes2Base64(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")},window.Bytes2Base64=function(e){var t="";if("string"==typeof e)t=unescape(encodeURIComponent(e));else{e instanceof ArrayBuffer&&(e=new Uint8Array(e));for(var n=0;n<e.length;n++)t+=String.fromCharCode(e[n])}return btoa(t)}}(),function(){"use strict";var msg="";try{window.PageRawHTML=window.PageRawHTML||document.documentElement.outerHTML;var SupportCrypto=!1;eval("SupportCrypto=!!crypto.subtle.sign"),eval("``;(async function(){class a{}})")}catch(e){return msg||SupportCrypto||!1!==window.isSecureContext||(msg="no-https"),msg||(msg=SupportCrypto?"browser-old-version":"no-crypto"),void(window.location.href="/info/errorPage/?msg="+encodeURIComponent(msg))}$(".main").html($(".main").html()),$("input,textarea,select").attr("autocomplete","off"),$(".main-load").hide(),$(".main").show(),LangClick(LangCur),initMainUI()}();